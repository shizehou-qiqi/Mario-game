<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é©¬é‡Œå¥¥æ¸¸æˆè°ƒè¯•</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #f0f0f0;
            font-family: Arial, sans-serif;
        }
        
        #gameContainer {
            background: white;
            border: 2px solid #333;
            display: inline-block;
            position: relative;
        }
        
        #gameCanvas {
            display: block;
            background: #87CEEB;
        }
        
        #debugInfo {
            margin-top: 20px;
            padding: 10px;
            background: #333;
            color: white;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        #controls {
            margin-top: 10px;
        }
        
        button {
            margin: 5px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>é©¬é‡Œå¥¥æ¸¸æˆè°ƒè¯• ğŸ”§</h1>
    
    <div id="gameContainer">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
    </div>
    
    <div id="controls">
        <button onclick="startDebugGame()">å¼€å§‹æ¸¸æˆ</button>
        <button onclick="showGameObjects()">æ˜¾ç¤ºæ¸¸æˆå¯¹è±¡</button>
        <button onclick="testInput()">æµ‹è¯•è¾“å…¥</button>
        <button onclick="showPlayerStatus()">æ˜¾ç¤ºç©å®¶çŠ¶æ€</button>
        <button onclick="clearDebug()">æ¸…é™¤è°ƒè¯•ä¿¡æ¯</button>
    </div>
    
    <div id="debugInfo">è°ƒè¯•ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</div>

    <!-- åŠ è½½æ‰€æœ‰å¿…è¦çš„è„šæœ¬ -->
    <script src="js/vector2d.js"></script>
    <script src="js/gameObject.js"></script>
    <script src="js/platform.js"></script>
    <script src="js/player.js"></script>
    <script src="js/goomba.js"></script>
    <script src="js/coin.js"></script>
    <script src="js/physics.js"></script>
    <script src="js/inputManager.js"></script>
    <script src="js/gameEngine.js"></script>
    <script src="js/level.js"></script>
    <script src="js/scoreManager.js"></script>
    <script src="js/hudManager.js"></script>
    <script src="js/gameStateManager.js"></script>
    <script src="js/eventManager.js"></script>
    <script src="js/audioManager.js"></script>
    <script src="js/particleSystem.js"></script>

    <script>
        let gameEngine;
        let currentLevel;
        let player;
        let inputManager;
        let scoreManager;
        let hudManager;
        let gameStateManager;
        
        function log(message) {
            const debugInfo = document.getElementById('debugInfo');
            const timestamp = new Date().toLocaleTimeString();
            debugInfo.textContent += `[${timestamp}] ${message}\n`;
            debugInfo.scrollTop = debugInfo.scrollHeight;
            console.log(message);
        }
        
        function clearDebug() {
            document.getElementById('debugInfo').textContent = '';
        }
        
        function startDebugGame() {
            log('ğŸ® å¼€å§‹è°ƒè¯•æ¸¸æˆ...');
            
            try {
                // åˆå§‹åŒ–æ¸¸æˆå¼•æ“
                const canvas = document.getElementById('gameCanvas');
                gameEngine = new GameEngine(canvas);
                gameEngine.init();
                log('âœ… æ¸¸æˆå¼•æ“åˆå§‹åŒ–æˆåŠŸ');
                
                // åˆå§‹åŒ–è¾“å…¥ç®¡ç†å™¨
                inputManager = new InputManager();
                inputManager.init();
                window.inputManager = inputManager;
                log('âœ… è¾“å…¥ç®¡ç†å™¨åˆå§‹åŒ–æˆåŠŸ');
                log(`âœ… window.inputManager è®¾ç½®æˆåŠŸ: ${!!window.inputManager}`);
                
                // åˆå§‹åŒ–åˆ†æ•°ç®¡ç†å™¨
                scoreManager = new ScoreManager();
                log('âœ… åˆ†æ•°ç®¡ç†å™¨åˆå§‹åŒ–æˆåŠŸ');
                
                // åˆ›å»ºå…³å¡
                currentLevel = new Level();
                currentLevel.loadLevel();
                log(`âœ… å…³å¡åˆ›å»ºæˆåŠŸï¼ŒåŒ…å« ${currentLevel.getAllObjects().length} ä¸ªå¯¹è±¡`);
                
                // å°†å…³å¡å¯¹è±¡æ·»åŠ åˆ°æ¸¸æˆå¼•æ“
                const levelObjects = currentLevel.getAllObjects();
                levelObjects.forEach(obj => {
                    gameEngine.addGameObject(obj);
                });
                log(`âœ… ${levelObjects.length} ä¸ªå…³å¡å¯¹è±¡æ·»åŠ åˆ°æ¸¸æˆå¼•æ“`);
                
                // åˆ›å»ºç©å®¶
                const spawnPoint = currentLevel.getSpawnPoint();
                player = new Player(spawnPoint.x, spawnPoint.y);
                player.init(); // ğŸ”§ é‡è¦ï¼šåˆå§‹åŒ–ç©å®¶
                gameEngine.addGameObject(player);
                log(`âœ… ç©å®¶åˆ›å»ºæˆåŠŸï¼Œä½ç½®: (${spawnPoint.x}, ${spawnPoint.y})`);
                
                // è®¾ç½®ç›¸æœºè·Ÿéš
                currentLevel.setCameraTarget(player);
                log('âœ… ç›¸æœºè®¾ç½®æˆåŠŸ');
                
                // åˆ›å»ºHUD
                hudManager = new HUDManager(scoreManager);
                gameEngine.addGameObject(hudManager);
                log('âœ… HUDç®¡ç†å™¨åˆ›å»ºæˆåŠŸ');
                
                // å¯åŠ¨æ¸¸æˆå¼•æ“
                gameEngine.start();
                log('âœ… æ¸¸æˆå¼•æ“å¯åŠ¨æˆåŠŸ');
                
                log('ğŸ‰ æ¸¸æˆè°ƒè¯•å¯åŠ¨å®Œæˆï¼');
                
            } catch (error) {
                log(`âŒ é”™è¯¯: ${error.message}`);
                console.error(error);
            }
        }
        
        function showGameObjects() {
            if (!gameEngine) {
                log('âŒ æ¸¸æˆå¼•æ“æœªåˆå§‹åŒ–');
                return;
            }
            
            log('ğŸ“‹ å½“å‰æ¸¸æˆå¯¹è±¡åˆ—è¡¨:');
            gameEngine.gameObjects.forEach((obj, index) => {
                log(`  ${index}: ${obj.tag || obj.constructor.name} at (${obj.position.x.toFixed(1)}, ${obj.position.y.toFixed(1)})`);
            });
            log(`æ€»è®¡: ${gameEngine.gameObjects.length} ä¸ªå¯¹è±¡`);
        }
        
        function testInput() {
            if (!inputManager) {
                log('âŒ è¾“å…¥ç®¡ç†å™¨æœªåˆå§‹åŒ–');
                return;
            }

            log('ğŸ® æµ‹è¯•è¾“å…¥ç³»ç»Ÿ...');
            log(`å·¦é”®çŠ¶æ€ (ArrowLeft): ${inputManager.isKeyPressed('ArrowLeft')}`);
            log(`å³é”®çŠ¶æ€ (ArrowRight): ${inputManager.isKeyPressed('ArrowRight')}`);
            log(`ç©ºæ ¼é”®çŠ¶æ€ (Space): ${inputManager.isKeyPressed('Space')}`);
            log(`ä¸Šé”®çŠ¶æ€ (ArrowUp): ${inputManager.isKeyPressed('ArrowUp')}`);
            log(`ESCé”®çŠ¶æ€ (Escape): ${inputManager.isKeyPressed('Escape')}`);
            log('è¯·æŒ‰é”®ç›˜æŒ‰é”®æµ‹è¯•...');

            // æ˜¾ç¤ºå½“å‰æ‰€æœ‰æŒ‰ä¸‹çš„é”®
            const pressedKeys = Object.keys(inputManager.keys).filter(key => inputManager.keys[key]);
            if (pressedKeys.length > 0) {
                log(`å½“å‰æŒ‰ä¸‹çš„é”®: ${pressedKeys.join(', ')}`);
            } else {
                log('å½“å‰æ²¡æœ‰æŒ‰é”®è¢«æŒ‰ä¸‹');
            }
        }

        function showPlayerStatus() {
            if (!player) {
                log('âŒ ç©å®¶æœªåˆ›å»º');
                return;
            }

            log('ğŸ‘¤ ç©å®¶çŠ¶æ€:');
            log(`  ä½ç½®: (${player.position.x.toFixed(1)}, ${player.position.y.toFixed(1)})`);
            log(`  é€Ÿåº¦: (${player.velocity.x.toFixed(1)}, ${player.velocity.y.toFixed(1)})`);
            log(`  æ˜¯å¦åœ¨åœ°é¢: ${player.isGrounded}`);
            log(`  è¾“å…¥çŠ¶æ€:`);
            log(`    å·¦: ${player.inputState.left}`);
            log(`    å³: ${player.inputState.right}`);
            log(`    è·³è·ƒ: ${player.inputState.jump}`);
            log(`    è·³è·ƒæŒ‰ä¸‹: ${player.inputState.jumpPressed}`);
            log(`  ç§»åŠ¨é€Ÿåº¦: ${player.moveSpeed}`);
            log(`  æœ€å¤§é€Ÿåº¦: ${player.maxSpeed}`);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        window.addEventListener('load', () => {
            log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå‡†å¤‡è°ƒè¯•');
        });
    </script>
</body>
</html>
